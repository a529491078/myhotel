<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.fjzzit.web.myhotel.mapper.RoomInfoMapper">
  <resultMap id="BaseResultMap" type="com.edu.fjzzit.web.myhotel.model.RoomInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="room_id" jdbcType="VARCHAR" property="roomId" />
    <result column="building_num" jdbcType="VARCHAR" property="buildingNum" />
    <result column="room_num" jdbcType="VARCHAR" property="roomNum" />
    <result column="room_type_num" jdbcType="BIGINT" property="roomTypeNum" />
  </resultMap>

  <resultMap id="RoomTypeMap" type="com.edu.fjzzit.web.myhotel.model.RoomType" >
    <id column="room_type_num" property="roomTypeNum" jdbcType="BIGINT" />
    <result column="room_type_name" property="roomTypeName" jdbcType="VARCHAR" />
    <result column="bed_type" property="bedType" jdbcType="VARCHAR" />
    <result column="floor" property="floor" jdbcType="VARCHAR" />
    <result column="room_type_decs" property="roomTypeDecs" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="RoomPriceMap" type="com.edu.fjzzit.web.myhotel.model.RoomPrice" >
    <id column="room_price_num" property="roomPriceNum" jdbcType="BIGINT" />
    <result column="room_type_num" property="roomTypeNum" jdbcType="BIGINT" />
    <result column="room_price_name" property="roomPriceName" jdbcType="VARCHAR" />
    <result column="breakfast_type" property="breakfastType" jdbcType="VARCHAR" />
    <result column="room_price" property="roomPrice" jdbcType="INTEGER" />
  </resultMap>

  <resultMap id="RoomInfoRoomTypeRoomPriceDTOMap" type="com.edu.fjzzit.web.myhotel.dto.RoomInfoRoomTypeRoomPriceDTO" >
    <result column="room_type_num" property="roomTypeNum" jdbcType="BIGINT" />
    <result column="room_price_name" property="roomPriceName" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="RoomTypeAndRoomPriceDTOMap" type="com.edu.fjzzit.web.myhotel.dto.RoomTypeAndRoomPriceDTO" >
    <id column="room_type_num" property="roomTypeNum" jdbcType="BIGINT" />
    <result column="room_type_name" property="roomTypeName" jdbcType="VARCHAR" />
    <result column="bed_type" property="bedType" jdbcType="VARCHAR" />
    <result column="room_type_img" property="roomTypeImg" jdbcType="VARCHAR" />
    <result column="floor" property="floor" jdbcType="VARCHAR" />
    <result column="room_type_decs" property="roomTypeDecs" jdbcType="VARCHAR" />
    <result column="room_price_name" property="roomPriceName" jdbcType="VARCHAR" />
    <result column="breakfast_type" property="breakfastType" jdbcType="VARCHAR" />
    <result column="room_price" property="roomPrice" jdbcType="INTEGER" />
  </resultMap>

  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    room_id, building_num, room_num, room_type_num
  </sql>
  <select id="selectRoomNumByRoomTypeNum" resultType="java.lang.String">
    select room_num
    from room_info
    where room_type_num=#{roomTypeNum,jdbcType=BIGINT} and room_state=#{roomState,jdbcType=INTEGER}
  </select>
  <!--查询房间号是否存在-->
  <select id="queryRoomNumIsExists" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*)
    from room_info
    where room_num=#{roomNum,jdbcType=VARCHAR}
  </select>

  <select id="queryRoomNumByRoomNumAndBuildingNum" parameterType="java.lang.String" resultType="java.lang.Integer">
    select count(*)
    from room_info
    where room_num=#{roomNum,jdbcType=VARCHAR} and building_num=#{buildingNum,jdbcType=VARCHAR}
  </select>

  <update id="updateRoomStateByRoomNum">
    update room_info
    set room_state=#{roomState,jdbcType=INTEGER}
    where room_num=#{roomNum,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from room_info
    where room_id = #{roomId,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from room_info
    where room_id = #{roomId,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.edu.fjzzit.web.myhotel.model.RoomInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into room_info (room_id, building_num, room_num, 
      room_type_num)
    values (#{roomId,jdbcType=VARCHAR}, #{buildingNum,jdbcType=VARCHAR}, #{roomNum,jdbcType=VARCHAR}, 
      #{roomTypeNum,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="com.edu.fjzzit.web.myhotel.model.RoomInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into room_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="roomId != null">
        room_id,
      </if>
      <if test="buildingNum != null">
        building_num,
      </if>
      <if test="roomNum != null">
        room_num,
      </if>
      <if test="roomTypeNum != null">
        room_type_num,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="roomId != null">
        #{roomId,jdbcType=VARCHAR},
      </if>
      <if test="buildingNum != null">
        #{buildingNum,jdbcType=VARCHAR},
      </if>
      <if test="roomNum != null">
        #{roomNum,jdbcType=VARCHAR},
      </if>
      <if test="roomTypeNum != null">
        #{roomTypeNum,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.edu.fjzzit.web.myhotel.model.RoomInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update room_info
    <set>
      <if test="buildingNum != null">
        building_num = #{buildingNum,jdbcType=VARCHAR},
      </if>
      <if test="roomNum != null">
        room_num = #{roomNum,jdbcType=VARCHAR},
      </if>
      <if test="roomTypeNum != null">
        room_type_num = #{roomTypeNum,jdbcType=BIGINT},
      </if>
    </set>
    where room_id = #{roomId,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.edu.fjzzit.web.myhotel.model.RoomInfo">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update room_info
    set building_num = #{buildingNum,jdbcType=VARCHAR},
      room_num = #{roomNum,jdbcType=VARCHAR},
      room_type_num = #{roomTypeNum,jdbcType=BIGINT}
    where room_id = #{roomId,jdbcType=VARCHAR}
  </update>

  <!-- 分页查询 -->
  <select id="findRoomInfoAll" resultMap="BaseResultMap">
     select * from room_info limit #{pageStart},#{pageSize}
  </select>

  <!-- 分页查询客房套餐 -->
  <select id="findRoomTypeAndRoomPriceAll" resultMap="RoomTypeAndRoomPriceDTOMap">
     select t.room_type_num,room_type_name,bed_type,room_type_img,floor,room_type_decs,room_price_name,
     breakfast_type,room_price
     from room_type t
     LEFT JOIN room_price p on t.room_type_num = p.room_type_num limit #{pageStart},#{pageSize}
  </select>

  <!-- 根据room_type_num查询客房类型表-->
  <select id="findRoomTypeByRoomTypeNum" resultMap="RoomTypeMap">
     select * from room_type where room_type_num=#{roomTypeNum,jdbcType=BIGINT}
  </select>

  <!-- 根据room_type_name查询客房类型id -->
  <select id="findRoomTypeNumByRoomTypeNanme" resultType="java.lang.Long">
     select room_type_num from room_type where room_type_name=#{roomTypeName,jdbcType=VARCHAR}
  </select>

  <!-- 根据room_type_num查询客房价格表-->
  <select id="findRoomPriceByRoomTypeNum" resultMap="RoomPriceMap">
     select * from room_price where room_type_num=#{roomTypeNum,jdbcType=BIGINT}
  </select>

  <!-- 查询所有记录数-->
  <select id="selCount" resultType="java.lang.Long">
    select count(*) from room_info
  </select>

  <!-- 查询所有记录数-->
  <select id="selRoomTypeAndRoomPriceCount" resultType="java.lang.Long">
    select count(*) from room_type t
    LEFT JOIN room_price p on t.room_type_num = p.room_type_num
  </select>

  <!-- 查询客房套餐名和客房类型ID-->
  <select id="findRoomPriceNameAll" resultMap="RoomInfoRoomTypeRoomPriceDTOMap">
    select p.room_price_name,t.room_type_num from room_type as t inner join room_price p on t.room_type_num =p.room_type_num;
  </select>

  <!-- 根据ID查询客房套餐 -->
  <select id="findRoomTypeAndRoomPriceById" resultMap="RoomTypeAndRoomPriceDTOMap">
    select t.room_type_num,room_type_name,room_type_img,bed_type,room_type_img,floor,room_type_decs,room_price_name,
    breakfast_type,room_price
    from room_type t
    LEFT JOIN room_price p on t.room_type_num = p.room_type_num
    <where>
      <if test="roomTypeNum !=null and roomTypeNum!=''">
        and t.room_type_num = #{roomTypeNum,jdbcType=BIGINT}
      </if>
    </where>
  </select>

  <!-- 根据room_type_num删除客房套餐信息-->
  <delete id="delRoomTypeAndRoomPriceById" parameterType="java.lang.Long" >
    delete t,p
    from room_price as p
    LEFT join room_type as t on t.room_type_num = p.room_type_num
    where t.room_type_num = #{roomTypeNum,jdbcType=BIGINT}
  </delete>

  <!-- 根据room_type_num修改客房套餐信息-->
  <update id="updRoomTypeAndRoomPriceAll" >
    update room_type t INNER JOIN room_price p
    on t.room_type_num=p.room_type_num
    set <if test="roomTypeName != null" >
    room_type_name = #{roomTypeName,jdbcType=VARCHAR},
  </if>
    <if test="bedType != null" >
      bed_type = #{bedType,jdbcType=VARCHAR},
    </if>
    <if test="roomTypeImg != null" >
      room_type_img = #{roomTypeImg,jdbcType=VARCHAR},
    </if>
    <if test="floor != null" >
      floor = #{floor,jdbcType=VARCHAR},
    </if>
    <if test="roomTypeDecs != null" >
      room_type_decs = #{roomTypeDecs,jdbcType=VARCHAR},
    </if>
    <if test="roomPriceName != null" >
      room_price_name = #{roomPriceName,jdbcType=VARCHAR},
    </if>
    <if test="breakfastType != null" >
      breakfast_type = #{breakfastType,jdbcType=VARCHAR},
    </if>
    <if test="roomPrice != null" >
      room_price = #{roomPrice,jdbcType=INTEGER}
    </if>
    where t.room_type_num = #{roomTypeNum,jdbcType=BIGINT}
  </update>

</mapper>